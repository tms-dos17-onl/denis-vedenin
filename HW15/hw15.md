<!-- Дедлайн: 14/09/2023

1. Установить MySQL на VM.
2. (**) Настроить Multi-Primary репликацию для MySQL на 2 VM согласно инструкции.
3. Создать схему БД clinic и наполнить её данными используя скрипты из https://github.com/tms-dos17-onl/_sandbox/tree/main/lecture18/mysql/initdb.d/data.
4. Создать бэкап базы данных clinic.
5. Написать следующие SQL запросы:
- Вывести всех врачей, работающих в терапевтическом отделении.
- Вывести в каких отделениях побывал каждый пациент.
- Обновить дату приёма для пациента Ивана Иванова на 2022-02-09.
- Удалить врача Андрея Быкова и все его приёмы.
- Добавить нового врача Фила Ричардса и новую пациентку Василису Васильеву и записать её к Филу Ричардсу на приём на 2022-02-14.
6. Восстановить базу данных clinic из бэкапа и проверить, что данные соответствуют состоянию базы данных до внесенных в предыдущем задании изменений.
7. Установить MongoDB
8. Создать БД clinic и наполнить её данными используя скрипты из https://github.com/tms-dos17-onl/_sandbox/tree/main/lecture18/mongo/initdb.d.
9. Написать выборочно 3 запроса из задания 4 для MongoDB используя mongosh команды.

** не обязательны к выполнению. Задачи на интерес -->

# 1. Установить MySQL на VM.
```
denis@denis-VirtualBox:~$ sudo apt update

denis@denis-VirtualBox:~$ sudo apt install mysql-server

denis@denis-VirtualBox:~$ sudo systemctl start mysql.service

denis@denis-VirtualBox:~$ sudo systemctl status mysql.service
● mysql.service - MySQL Community Server
     Loaded: loaded (/lib/systemd/system/mysql.service; enabled; vendor preset:>
     Active: active (running) since Wed 2023-09-06 18:31:32 +03; 34min ago
   Main PID: 1166 (mysqld)
     Status: "Server is operational"
      Tasks: 37 (limit: 4593)
     Memory: 425.3M
        CPU: 22.647s
     CGroup: /system.slice/mysql.service
             └─1166 /usr/sbin/mysqld


denis@denis-VirtualBox:~$ sudo mysql
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 8
Server version: 8.0.34-0ubuntu0.22.04.1 (Ubuntu)

Copyright (c) 2000, 2023, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'password';
Query OK, 0 rows affected (0,14 sec)

mysql> exit
Bye
```
```
denis@denis-VirtualBox:~$ sudo mysql_secure_installation

Securing the MySQL server deployment.

Enter password for user root: 

VALIDATE PASSWORD COMPONENT can be used to test passwords
and improve security. It checks the strength of password
and allows the users to set only those passwords which are
secure enough. Would you like to setup VALIDATE PASSWORD component?

Press y|Y for Yes, any other key for No: y

There are three levels of password validation policy:

LOW    Length >= 8
MEDIUM Length >= 8, numeric, mixed case, and special characters
STRONG Length >= 8, numeric, mixed case, special characters and dictionary                  file

Please enter 0 = LOW, 1 = MEDIUM and 2 = STRONG: 0
Using existing password for root.

Estimated strength of the password: 50 

Change the password for root ? (Press y|Y for Yes, any other key for No) : password

 ... skipping.

By default, a MySQL installation has an anonymous user,
allowing anyone to log into MySQL without having to have
a user account created for them. This is intended only for
testing, and to make the installation go a bit smoother.
You should remove them before moving into a production
environment.

Remove anonymous users? (Press y|Y for Yes, any other key for No) : n

 ... skipping.

Normally, root should only be allowed to connect from
'localhost'. This ensures that someone cannot guess at
the root password from the network.

Disallow root login remotely? (Press y|Y for Yes, any other key for No) : n

 ... skipping.

By default, MySQL comes with a database named 'test' that
anyone can access. This is also intended only for testing,
and should be removed before moving into a production
environment.

Remove test database and access to it? (Press y|Y for Yes, any other key for No) : n

 ... skipping.

Reloading the privilege tables will ensure that all changes
made so far will take effect immediately.

Reload privilege tables now? (Press y|Y for Yes, any other key for No) : y
Success.
All done! 
```

# 2. (**) Настроить Multi-Primary репликацию для MySQL на 2 VM согласно инструкции.
```
1 SERV
denis@denis-VirtualBox:~$ sudo mysql -u root -p
[sudo] пароль для denis:
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 8
Server version: 8.0.34-0ubuntu0.22.04.1 (Ubuntu)

Copyright (c) 2000, 2023, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> SELECT UUID();
+--------------------------------------+
| UUID()                               |
+--------------------------------------+
| bfc402b9-4cdb-11ee-b94f-080027f2d229 |
+--------------------------------------+
1 row in set (0,00 sec)

denis@denis-VirtualBox:~$ sudo mysql -u root -p
Enter password:

mysql> SET SQL_LOG_BIN=0;
Query OK, 0 rows affected (0,00 sec)

mysql> CREATE USER 'replication_user'@'%' IDENTIFIED WITH mysql_native_password BY 'PASSWORD@USER';
ERROR 1819 (HY000): Your password does not satisfy the current policy requirements
mysql> CREATE USER 'replication_user'@'%' IDENTIFIED WITH mysql_native_password BY 'password';
ERROR 1819 (HY000): Your password does not satisfy the current policy requirements
mysql> CREATE USER 'replication_user'@'%' IDENTIFIED WITH mysql_native_password BY 'ei7veeChu4bo';
ERROR 1819 (HY000): Your password does not satisfy the current policy requirements
mysql> CREATE USER 'replication_user'@'%' IDENTIFIED WITH mysql_native_password BY 'Password123#@!';
Query OK, 0 rows affected (0,08 sec)

mysql> GRANT REPLICATION SLAVE ON *.* TO 'replication_user'@'%';
Query OK, 0 rows affected (0,07 sec)

mysql> FLUSH PRIVILEGES;
Query OK, 0 rows affected (0,00 sec)

mysql> SET SQL_LOG_BIN=1;
Query OK, 0 rows affected (0,00 sec)

mysql> CHANGE MASTER TO MASTER_USER='replication_user', MASTER_PASSWORD='Password123#@!' FOR CHANNEL 'group_replication_recovery';
Query OK, 0 rows affected, 5 warnings (1,21 sec)

Загрузите плагин групповой репликации на первом сервере
Загружайте только одного члена группы, чтобы избежать создания нескольких групп с одним и тем же именем. Для этого выполните приведенные ниже команды на первом сервере.

mysql> SET GLOBAL group_replication_bootstrap_group=ON;

mysql> START GROUP_REPLICATION;

Отключите group_replication_bootstrap_group , чтобы избежать создания нескольких групп при перезапуске сервера MySQL.

mysql> SET GLOBAL group_replication_bootstrap_group=OFF;
Проверьте статус группы, запросив replication_group_members .

mysql> SELECT MEMBER_ID, MEMBER_HOST, MEMBER_STATE FROM performance_schema.replication_group_members;
+--------------------------------------+----------------+--------------+
| MEMBER_ID                            | MEMBER_HOST    | MEMBER_STATE |
+--------------------------------------+----------------+--------------+
| f5b1f442-41d3-11ee-8e6d-080027f2d229 | 192.168.56.109 | ONLINE       |
+--------------------------------------+----------------+--------------+
1 row in set (0,04 sec)
```

```
2 SERV
mysql> SELECT UUID();
+--------------------------------------+
| UUID()                               |
+--------------------------------------+
| 369d59f5-4cdc-11ee-a8df-0800276482de |
+--------------------------------------+
1 row in set (0,00 sec)

mysql> SELECT MEMBER_ID, MEMBER_HOST, MEMBER_STATE FROM performance_schema.replication_group_members;
+--------------------------------------+----------------+--------------+
| MEMBER_ID                            | MEMBER_HOST    | MEMBER_STATE |
+--------------------------------------+----------------+--------------+
| 28904ef1-4cd7-11ee-a2e6-0800276482de | 192.168.56.106 | ONLINE       |
+--------------------------------------+----------------+--------------+
1 row in set (0,01 sec)
```
![](/HW15/screenHW15/host_state.PNG)
